version: "3.8"

services:
  ai-toolkit:
    image: ostris/aitoolkit:latest
    restart: unless-stopped
    ports:
      - "8675:8675"
    volumes:
      - ~/.cache/huggingface/hub:/root/.cache/huggingface/hub:z
      - ./aitk_db.db:/app/ai-toolkit/aitk_db.db:z
      - ./datasets:/app/ai-toolkit/datasets:z
      - ./output:/app/ai-toolkit/output:z
      - ./config:/app/ai-toolkit/config:z
    environment:
      - AI_TOOLKIT_AUTH=${AI_TOOLKIT_AUTH:-password}
      - NODE_ENV=production
      - TZ=UTC
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]
    security_opt:
      - label=disable
